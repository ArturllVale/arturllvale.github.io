<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="description" content="Ferramenta gratuita que auxilia na criação de servidores de ragnarok" />
    <meta name="keywords" content="rathena, ragnarok online,ragnarok script npc, mr tools" />
    <meta name="author" content="Artur Vale | Lumenbr" />
    <meta name="permissions-policy" content="interest-cohort=()"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MR Tools</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <script src="js/functions.js"></script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="css/estilo.css" />
</head>

<body>
    <div id="navbar"></div>
    <div id="header"></div>
    <div class="container page-main">
        <div class="row">
            <!-- Gerador de Status Points -->
            <div class="col-md-6 espacogas">
                <h3 id="statspoint">Gerador de statpoint.yml</h3>
                <label for="numLinhas" class="form-label">Level Máximo:</label>
                <input type="number" class="form-control status-level" id="numLinhas" min="1" value="1" />
                <br />
                <label for="numMaximo" class="form-label">Pontos Máximos:</label>
                <input type="number" class="form-control status-point" id="numMaximo" min="1" value="1" />
                <br />
                <button onclick="gerarEsquema()" class="btn btn-primary">Gerar Arquivo</button>
            </div>
            <div class="col-md-6">
                <h3>O que é stats points?</h3>
                <img src="img/img01.png" alt="" class="imgbg01 imagem">
                <p class="contornotext">Stats points ou pontos de status são aqueles pontos que você ganha ao passar de
                    level
                    usados para distribuição de pontos dos seus atributos como força, agilidade, vitalidade,
                    inteligência,
                    destreza e sorte.
                </p>
            </div>
            <div class="container-fluid espacamentos">
                <img src="img/banner2.png" class="img-fluid imagem banner2" alt="">
            </div>
            <div class="col-md-6">
                <h3 class="h3ajuste">O que é o Cash Shop?</h3>
                <img src="img/img02.png" alt="" class="imgbg02 imagem">
                <p class="contornotext">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ut ipsum
                    laoreet, egestas libero ut,
                    elementum lorem. Nulla facilisi. Integer molestie viverra nisl vitae rhoncus. Phasellus a urna vel
                    augue tristique ornare. Curabitur turpis nunc, efficitur nec sem ac, dignissim sodales ante. Orci
                    varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed elementum
                    varius nisl a fermentum.</p>

            </div>
            <!-- Gerador de Item do Cashshop 2023 -->
            <div class="col-md-6">
                <h3 id="cashshopi" class="h3ajuste">Itens para o Cash Shop 2023</h3>
                <div id="cashshop">
                    <div class="block">
                        <select class="tab form-select menu-cash">
                            <option value="New">New</option>
                            <option value="Hot">Hot</option>
                            <option value="Limited">Limited</option>
                            <option value="Rental">Rental</option>
                            <option value="Permanent">Permanent</option>
                            <option value="Scrolls">Scrolls</option>
                            <option value="Consumables">Consumables</option>
                            <option value="Other">Other</option>
                        </select>
                        <input type="text" placeholder="Item" class="item form-control">
                        <input type="text" placeholder="Price" class="price form-control">
                    </div>
                </div>
                <button onclick="addBlock()" class="btn btn-success">Adicionar Item</button>
                <button onclick="generateTxt()" class="btn btn-primary">Gerar Arquivo</button>
            </div>
            <!-- Gerador coluna 3 -->
            <div class="col-md-6">
                <h3>Gerador de Background</h3>
                <input type="file" id="imageInput" accept=".jpg, .jpeg, .png" />
                <button onclick="processAndDownload()">Processar e Baixar .zip</button>
            </div>
            <div class="col-md-6"></div>
        </div>
    </div>
    <div class="container-fluid espacamentos">
        <img src="img/banner3.png" class="img-fluid imagem banner2" alt="">
    </div>
    <div id="footer"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
        </script>
        <script>
           let selectedImage = null;

document.getElementById('imageInput').addEventListener('change', handleImageSelect);

function handleImageSelect(event) {
    const fileInput = event.target;
    const file = fileInput.files[0];

    if (file) {
        const reader = new FileReader();
        reader.onload = function() {
            const img = new Image();
            img.src = reader.result;
            img.onload = function() {
                const resizedImg = resizeImage(img, 256 * 4, 256 * 3);
                selectedImage = resizedImg;
                alert('Imagem selecionada com sucesso!');
            };
        };

        reader.readAsDataURL(file);
    } else {
        alert('Por favor, selecione uma imagem.');
    }
}

function resizeImage(img, width, height) {
    const canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, width, height);
    return canvas;
}

function processAndDownload() {
    if (!selectedImage) {
        alert('Por favor, selecione uma imagem.');
        return;
    }

    const zip = new JSZip();
    const tileSize = 256;
    const rows = 3;
    const cols = 4;

    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            const tileCanvas = document.createElement('canvas');
            tileCanvas.width = tileSize;
            tileCanvas.height = tileSize;
            const tileCtx = tileCanvas.getContext('2d');
            tileCtx.drawImage(selectedImage, col * tileSize, row * tileSize, tileSize, tileSize, 0, 0, tileSize, tileSize);
            const tileDataUrl = canvasToBMPDataUrl(tileCanvas);
            zip.file(`tile_${row}_${col}.bmp`, tileDataUrl.split(',')[1], { base64: true });
        }
    }

    zip.generateAsync({ type: 'blob' }).then(function(content) {
        const zipUrl = URL.createObjectURL(content);
        const link = document.createElement('a');
        link.href = zipUrl;
        link.download = 'tiles.zip'; // Nome do arquivo .zip
        link.click();
        URL.revokeObjectURL(zipUrl);
    });
}

function canvasToBMPDataUrl(canvas) {
    // Converte um canvas para uma imagem BMP (base64)
    const imageData = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height);
    const header = 'data:image/bmp;base64,';
    const padding = (4 - (canvas.width * 3) % 4) % 4;
    const pixels = canvas.width * canvas.height * 3 + canvas.height * padding;
    const pixelArraySize = pixels + 54;
    const headerArray = new Uint8Array([
        0x42, 0x4D,       // BM
        pixelArraySize & 0xFF, (pixelArraySize >> 8) & 0xFF, (pixelArraySize >> 16) & 0xFF, (pixelArraySize >> 24) & 0xFF, // Tamanho do arquivo
        0x00, 0x00, 0x00, 0x00, // Reservado
        0x36, 0x00, 0x00, 0x00, // Offset para dados da imagem
        0x28, 0x00, 0x00, 0x00, // Tamanho do cabeçalho de informações (40 bytes)
        canvas.width & 0xFF, (canvas.width >> 8) & 0xFF, (canvas.width >> 16) & 0xFF, (canvas.width >> 24) & 0xFF, // Largura da imagem
        canvas.height & 0xFF, (canvas.height >> 8) & 0xFF, (canvas.height >> 16) & 0xFF, (canvas.height >> 24) & 0xFF, // Altura da imagem
        0x01, 0x00,       // Planos de cores
        0x18, 0x00,       // Bits por pixel (24 bits para RGB)
        0x00, 0x00, 0x00, 0x00, // Compressão (sem compressão)
        pixels & 0xFF, (pixels >> 8) & 0xFF, (pixels >> 16) & 0xFF, (pixels >> 24) & 0xFF, // Tamanho da imagem em pixels
        0x13, 0x0B, 0x00, 0x00, // Resolução horizontal em pixels por metro (2835 ppm)
        0x13, 0x0B, 0x00, 0x00, // Resolução vertical em pixels por metro (2835 ppm)
        0x00, 0x00, 0x00, 0x00, // Número de cores na paleta (usando paleta completa)
        0x00, 0x00, 0x00, 0x00, // Número de cores importantes (0 significa todas)
    ]);
    const bmpArray = new Uint8Array(headerArray.length + pixelArraySize);
    bmpArray.set(headerArray);
    for (let i = 0; i < pixels; i += 3) {
        const offset = i * 4 / 3;
        bmpArray.set([imageData.data[offset + 2], imageData.data[offset + 1], imageData.data[offset]], headerArray.length + i);
    }
    return header + btoa(String.fromCharCode.apply(null, bmpArray));
}

        </script>
</body>

</html>